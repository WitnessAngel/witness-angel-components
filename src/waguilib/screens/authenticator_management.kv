#:import tr waguilib.i18n.tr
#:import strip_external_app_prefix waguilib.importable_settings.strip_external_app_prefix


<OBSOLETE_LanguageMenuHeader@MDBoxLayout>:
    orientation: "vertical"
    adaptive_width: True
    padding: "10dp"
    height: dp(25)
    size_hint_y: None
    MDLabel:
        text: tr._("Language")
        font_style: "H6"
        adaptive_width: True


<ThinTwoLineAvatarIconListItem@TwoLineAvatarIconListItem>
    _height: dp(60)
    # This might help with the blurred content of scrollview... see https://github.com/kivy/kivy/issues/2297
    on_pos: self.pos = tuple(map(int, args[1]))

<UserKeyStoreListItem@ThinTwoLineAvatarIconListItem>:
    text: tr._("User Profile")
    secondary_text: tr._("Stored inside system disk")
    #tertiary_text: tr._("fit more text than usual")

    IconLeftWidget:
        icon: "account-box"

#<OpenFolderButton@Widget> UNUSED
    ##IRightBodyTouch+#MDRectangleFlatIconButton>:
    #text: " " # tr._("FindXXXXXXX")
    #icon: "file-find-outline"
    #size_hint: None, None
    #width: 100
    #height: 80
    #on_parent:
    #    ssss


<FolderKeyStoreListItem>:

    selected_path: None
    text: tr._("Custom location")
    secondary_text: strip_external_app_prefix(self.selected_path) if self.selected_path else tr._("Please select a folder")
    #tertiary_text: tr._("fit more text than usual2")

    on_size:
        """ UNUSED
        print(">>>>>>>>>>>>>>>> on_size", self.size, "but", open_folder_btn.width)
        self.ids._right_container.width = open_folder_btn.width
        self.ids._right_container.x = open_folder_btn.width
        self.ids._right_container.height = open_folder_btn.height
        self.ids._right_container.y = root.y + root.height/2 - open_folder_btn.height/2  # - dp(10)
        print(">>>>>>>>>>>>>>>> on_size NEW VALUES", self.ids._right_container.width, self.ids._right_container.x, self.ids._right_container.height, self.ids._right_container.y)
        self.do_layout()
        self.ids._right_container.do_layout()
        print(">>>>>>>>>>>>>>>> DO LAYOUT")
        self.canvas.ask_update()
        """

    #on_parent: UNUSED
        #print(">>>>>>>>>>>>>>>> on_parent", self.size)
        #Clock.schedule_once(lambda x: self.property('size').dispatch(args[0]))  # Useless

    IconLeftWidget:
        icon: "folder"
    IconRightWidget:
        icon: "file-find-outline"
        id: open_folder_btn


<AuthenticatorTesterContent@MDBoxLayout>
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "80dp"

    MDLabel:
        text: tr._("Test integrity and passphrase of authenticator")
    MDTextField:
        id: tester_passphrase
        hint_text: tr._("Passphrase")


<ElevatedMDBoxLayout@RectangularElevationBehavior+MDBoxLayout>:
    elevation: 20


<-SelectableLabel@TextInput>:
    readonly: True
    # Modified from kivy/data/style.kv
    canvas.before:
        # Clear (can be used to remove legacy canvas instructions)
        Color:
            rgba: self.background_color
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba:
                (self.cursor_color
                if self.focus and not self._cursor_blink
                else (0, 0, 0, 0))
        Rectangle:
            pos: self._cursor_visual_pos
            size: root.cursor_width, -self._cursor_visual_height
        Color:
            rgba: self.disabled_foreground_color if self.disabled else (self.hint_text_color if not self.text else self.foreground_color)


<AuthenticatorSelectorScreen>:

    on_pre_enter: root.refresh_authenticator_list()

    ScrollView:
        orientation: "vertical"

        MDGridLayout:
            cols: 1

            MDToolbar:
                title: tr._("Manage Authenticators")
                right_action_items: [["refresh", lambda x: root.refresh_authenticator_list(), tr._("Refresh")], ["earth", lambda x: root.language_menu_open(x), tr._("Language")], ["help-circle-outline", lambda x: root.display_help_popup(), tr._("Help")]]

            ElevatedMDBoxLayout:
                height: dp(40)
                size_hint_y: None

                md_bg_color: app.theme_cls.bg_light
                #line_color: [0, 0, 0, 1]

                MDLabel:
                    text: tr._("Please select an authenticator location")
                    halign: "left"
                    padding_x: "10dp"

            ScrollView:
                bar_width: 5
                bar_inactive_color: self.bar_color

                MDList:
                    id: authenticator_list

            ElevatedMDBoxLayout:
                height: dp(40)
                size_hint_y: None

                md_bg_color: app.theme_cls.bg_light
                #line_color: [0.2, 0.2, 0.2, 1]

                MDIcon:
                    icon: root.AUTHENTICATOR_INITIALIZATION_STATUS_ICONS[root.authenticator_status] # "language-python"
                    halign: "center"
                    width: dp(80)
                    size_hint_x: None

                MDLabel:
                    text: root.get_authenticator_status_message(root.authenticator_status)
                    halign: "left"

            ScrollView:
                size_hint_y: 0.5
                id: authenticator_information_scrollview
                SelectableLabel:
                    id: authenticator_information
                    padding: [10,10]
                    halign: "left"
                    size_hint: 1, None
                    height: max((len(self._lines)+1) * self.line_height, authenticator_information_scrollview.height)
                    text: tr._("<empty>")

            MDGridLayout:
                id: authenticator_actions_create
                cols: 2
                size_hint_x: 1
                size_hint_y: None
                height: self.minimum_height
                disabled: root.authenticator_status is not False
                spacing: 10
                padding: [10, 0]

                MDRectangleFlatIconButton:
                    anchor_x: "right"
                    halign: "center"
                    icon: "account-key-outline"
                    text: tr._("Initialize")
                    size_hint_x: 1
                    on_press: root.manager.current = "authenticator_creation_screen"

                MDRectangleFlatIconButton:
                    icon: "database-import-outline"
                    text: tr._("Import")
                    size_hint_x: 1
                    on_press: root.archive_chooser_open()

            MDGridLayout:
                id: authenticator_actions_modify
                cols: 2
                size_hint_x: 1
                size_hint_y: None
                height: self.minimum_height
                disabled: root.authenticator_status is not True
                spacing: 10
                padding: [10, 10]

                MDRectangleFlatIconButton:
                    icon: "database-export-outline"
                    text: tr._("Export")
                    size_hint_x: 1
                    on_press: root.show_authenticator_export_confirmation_dialog()

                MDRectangleFlatIconButton:
                    icon: "crosshairs-question"
                    text: tr._("Check")
                    size_hint_x: 1
                    on_press: root.show_checkup_dialog()

                MDRectangleFlatIconButton:
                    icon: "delete-alert-outline"
                    text: tr._("Destroy")
                    size_hint_x: 1
                    on_press: root.show_authenticator_destroy_confirmation_dialog()
